name: Build

on: [push, pull_request]

jobs:
  build_ubuntu:
    strategy:
      matrix:
        os: [ubuntu-latest]
        r-version: ['4.4.1']
    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up R ${{ matrix.r-version }}
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: ${{ matrix.r-version }}

    - name: Install dependencies
      uses: r-lib/actions/setup-r-dependencies@v2
      with:
        extra-packages: |
          any::testthat
          any::devtools
        working-directory: R

    - name: Test with testthat
      env:
        OS_NAME: ${{ matrix.os }}
      working-directory: R
      run: |
        Rscript -e 'devtools::load_all("atlasapprox"); testthat::test_dir("tests/testthat")'